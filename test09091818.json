{
  "metadata": {
    "analysis_date": "2025-09-18T18:08:32Z",
    "time_range": "Last 28 days (ago(28d))",
    "data_source": "cluster('azportalpartnerrow.westus.kusto.windows.net').database('AzurePortal').ClientTelemetry",
    "blade_scope": [
      "Extension/Microsoft_Azure_Policy/Blade/PolicyMenuBlade",
      "Extension/Microsoft_Azure_Policy/Blade/Compliance.ReactView", 
      "Extension/Microsoft_Azure_Policy/Blade/PolicyOverviewBladeV3",
      "Extension/Microsoft_Azure_Policy/Blade/PolicyComplianceDetail.ReactView",
      "Extension/Microsoft_Azure_Policy/Blade/ScopeSelectorBlade",
      "Extension/Microsoft_Azure_Policy/Blade/CreateEditSelectors.ReactView"
    ],
    "filters_applied": {
      "external_users_only": "userTypeHint == '' and requestUri startswith 'https://portal.'",
      "exclude_microsoft_tenant": "tenantId != '72f988bf-86f1-41af-91ab-2d7cd011db47'"
    },
    "notes": "All metrics use real fields from ClientTelemetry table. No assumptions made."
  },
  "queries_executed": {
    "mau_by_blade": {
      "query": "ClientTelemetry | where PreciseTimeStamp >= ago(28d) | where name in ('Extension/Microsoft_Azure_Policy/Blade/PolicyMenuBlade', 'Extension/Microsoft_Azure_Policy/Blade/Compliance.ReactView', 'Extension/Microsoft_Azure_Policy/Blade/PolicyOverviewBladeV3', 'Extension/Microsoft_Azure_Policy/Blade/PolicyComplianceDetail.ReactView', 'Extension/Microsoft_Azure_Policy/Blade/ScopeSelectorBlade', 'Extension/Microsoft_Azure_Policy/Blade/CreateEditSelectors.ReactView') | where userTypeHint == '' and requestUri startswith 'https://portal.' and tenantId != '72f988bf-86f1-41af-91ab-2d7cd011db47' | summarize MAU_Overall = dcount(userId), MAU_by_Blade = dcount(userId) by name | extend MetricName = 'Monthly Active Users (MAU)', TimeRange = 'Last 28 days'",
      "description": "Monthly Active Users per blade using distinct count of userId"
    },
    "mau_overall": {
      "query": "ClientTelemetry | where PreciseTimeStamp >= ago(28d) | where name in ('Extension/Microsoft_Azure_Policy/Blade/PolicyMenuBlade', 'Extension/Microsoft_Azure_Policy/Blade/Compliance.ReactView', 'Extension/Microsoft_Azure_Policy/Blade/PolicyOverviewBladeV3', 'Extension/Microsoft_Azure_Policy/Blade/PolicyComplianceDetail.ReactView', 'Extension/Microsoft_Azure_Policy/Blade/ScopeSelectorBlade', 'Extension/Microsoft_Azure_Policy/Blade/CreateEditSelectors.ReactView') | where userTypeHint == '' and requestUri startswith 'https://portal.' and tenantId != '72f988bf-86f1-41af-91ab-2d7cd011db47' | summarize MAU_Overall = dcount(userId) | extend MetricName = 'Monthly Active Users (MAU) - Overall', TimeRange = 'Last 28 days'",
      "description": "Overall Monthly Active Users across all Azure Policy blades"
    },
    "wau_by_blade_and_week": {
      "query": "ClientTelemetry | where PreciseTimeStamp >= ago(28d) | where name in ('Extension/Microsoft_Azure_Policy/Blade/PolicyMenuBlade', 'Extension/Microsoft_Azure_Policy/Blade/Compliance.ReactView', 'Extension/Microsoft_Azure_Policy/Blade/PolicyOverviewBladeV3', 'Extension/Microsoft_Azure_Policy/Blade/PolicyComplianceDetail.ReactView', 'Extension/Microsoft_Azure_Policy/Blade/ScopeSelectorBlade', 'Extension/Microsoft_Azure_Policy/Blade/CreateEditSelectors.ReactView') | where userTypeHint == '' and requestUri startswith 'https://portal.' and tenantId != '72f988bf-86f1-41af-91ab-2d7cd011db47' | extend WeekBucket = case(PreciseTimeStamp >= ago(7d), 'Week_4_Recent', PreciseTimeStamp >= ago(14d), 'Week_3', PreciseTimeStamp >= ago(21d), 'Week_2', PreciseTimeStamp >= ago(28d), 'Week_1_Oldest', 'Other') | where WeekBucket != 'Other' | summarize WAU = dcount(userId) by name, WeekBucket | order by name, WeekBucket | extend MetricName = 'Weekly Active Users (WAU)'",
      "description": "Weekly Active Users trends by blade for last 4 weeks"
    },
    "wau_overall_by_week": {
      "query": "ClientTelemetry | where PreciseTimeStamp >= ago(28d) | where name in ('Extension/Microsoft_Azure_Policy/Blade/PolicyMenuBlade', 'Extension/Microsoft_Azure_Policy/Blade/Compliance.ReactView', 'Extension/Microsoft_Azure_Policy/Blade/PolicyOverviewBladeV3', 'Extension/Microsoft_Azure_Policy/Blade/PolicyComplianceDetail.ReactView', 'Extension/Microsoft_Azure_Policy/Blade/ScopeSelectorBlade', 'Extension/Microsoft_Azure_Policy/Blade/CreateEditSelectors.ReactView') | where userTypeHint == '' and requestUri startswith 'https://portal.' and tenantId != '72f988bf-86f1-41af-91ab-2d7cd011db47' | extend WeekBucket = case(PreciseTimeStamp >= ago(7d), 'Week_4_Recent', PreciseTimeStamp >= ago(14d), 'Week_3', PreciseTimeStamp >= ago(21d), 'Week_2', PreciseTimeStamp >= ago(28d), 'Week_1_Oldest', 'Other') | where WeekBucket != 'Other' | summarize WAU_Overall = dcount(userId) by WeekBucket | order by WeekBucket | extend MetricName = 'Weekly Active Users (WAU) - Overall'",
      "description": "Overall Weekly Active Users trends across all blades for last 4 weeks"
    },
    "avg_sessions_per_user_by_blade": {
      "query": "ClientTelemetry | where PreciseTimeStamp >= ago(28d) | where name in ('Extension/Microsoft_Azure_Policy/Blade/PolicyMenuBlade', 'Extension/Microsoft_Azure_Policy/Blade/Compliance.ReactView', 'Extension/Microsoft_Azure_Policy/Blade/PolicyOverviewBladeV3', 'Extension/Microsoft_Azure_Policy/Blade/PolicyComplianceDetail.ReactView', 'Extension/Microsoft_Azure_Policy/Blade/ScopeSelectorBlade', 'Extension/Microsoft_Azure_Policy/Blade/CreateEditSelectors.ReactView') | where userTypeHint == '' and requestUri startswith 'https://portal.' and tenantId != '72f988bf-86f1-41af-91ab-2d7cd011db47' | summarize TotalSessions = dcount(sessionId), UniqueUsers = dcount(userId) by name | extend AvgSessionsPerUser = round(todouble(TotalSessions) / todouble(UniqueUsers), 2) | extend MetricName = 'Average Sessions per User' | project name, TotalSessions, UniqueUsers, AvgSessionsPerUser, MetricName",
      "description": "Average sessions per user by blade using sessionId and userId"
    },
    "avg_sessions_per_user_overall": {
      "query": "ClientTelemetry | where PreciseTimeStamp >= ago(28d) | where name in ('Extension/Microsoft_Azure_Policy/Blade/PolicyMenuBlade', 'Extension/Microsoft_Azure_Policy/Blade/Compliance.ReactView', 'Extension/Microsoft_Azure_Policy/Blade/PolicyOverviewBladeV3', 'Extension/Microsoft_Azure_Policy/Blade/PolicyComplianceDetail.ReactView', 'Extension/Microsoft_Azure_Policy/Blade/ScopeSelectorBlade', 'Extension/Microsoft_Azure_Policy/Blade/CreateEditSelectors.ReactView') | where userTypeHint == '' and requestUri startswith 'https://portal.' and tenantId != '72f988bf-86f1-41af-91ab-2d7cd011db47' | summarize TotalSessions_Overall = dcount(sessionId), UniqueUsers_Overall = dcount(userId) | extend AvgSessionsPerUser_Overall = round(todouble(TotalSessions_Overall) / todouble(UniqueUsers_Overall), 2) | extend MetricName = 'Average Sessions per User - Overall' | project TotalSessions_Overall, UniqueUsers_Overall, AvgSessionsPerUser_Overall, MetricName",
      "description": "Overall average sessions per user across all Azure Policy blades"
    },
    "blade_usage_summary": {
      "query": "ClientTelemetry | where PreciseTimeStamp >= ago(28d) | where name in ('Extension/Microsoft_Azure_Policy/Blade/PolicyMenuBlade', 'Extension/Microsoft_Azure_Policy/Blade/Compliance.ReactView', 'Extension/Microsoft_Azure_Policy/Blade/PolicyOverviewBladeV3', 'Extension/Microsoft_Azure_Policy/Blade/PolicyComplianceDetail.ReactView', 'Extension/Microsoft_Azure_Policy/Blade/ScopeSelectorBlade', 'Extension/Microsoft_Azure_Policy/Blade/CreateEditSelectors.ReactView') | where userTypeHint == '' and requestUri startswith 'https://portal.' and tenantId != '72f988bf-86f1-41af-91ab-2d7cd011db47' | extend BladeShortName = case(name contains 'PolicyMenuBlade', 'PolicyMenu', name contains 'Compliance.ReactView', 'Compliance', name contains 'PolicyOverviewBladeV3', 'PolicyOverview', name contains 'PolicyComplianceDetail', 'ComplianceDetail', name contains 'ScopeSelectorBlade', 'ScopeSelector', name contains 'CreateEditSelectors', 'CreateEdit', 'Other') | summarize UniqueUsers = dcount(userId), TotalSessions = dcount(sessionId) by BladeShortName | extend MetricName = 'Blade Usage Summary' | order by UniqueUsers desc",
      "description": "Blade usage summary with shortened names for Sankey diagram preparation"
    }
  },
  "metrics": {
    "monthly_active_users": {
      "overall": {
        "mau": 150649,
        "time_range": "Last 28 days"
      },
      "by_blade": [
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/PolicyMenuBlade",
          "blade_short_name": "PolicyMenu", 
          "mau": 128635
        },
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/Compliance.ReactView",
          "blade_short_name": "Compliance",
          "mau": 114227
        },
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/PolicyOverviewBladeV3", 
          "blade_short_name": "PolicyOverview",
          "mau": 78878
        },
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/PolicyComplianceDetail.ReactView",
          "blade_short_name": "ComplianceDetail", 
          "mau": 33136
        },
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/ScopeSelectorBlade",
          "blade_short_name": "ScopeSelector",
          "mau": 33972
        },
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/CreateEditSelectors.ReactView",
          "blade_short_name": "CreateEdit",
          "mau": 4765
        }
      ]
    },
    "weekly_active_users": {
      "overall_trend": [
        {
          "week": "Week_1_Oldest",
          "week_number": 1,
          "wau": 45333,
          "date_range": "ago(28d) to ago(21d)"
        },
        {
          "week": "Week_2", 
          "week_number": 2,
          "wau": 49461,
          "date_range": "ago(21d) to ago(14d)"
        },
        {
          "week": "Week_3",
          "week_number": 3, 
          "wau": 51344,
          "date_range": "ago(14d) to ago(7d)"
        },
        {
          "week": "Week_4_Recent",
          "week_number": 4,
          "wau": 49854,
          "date_range": "ago(7d) to now"
        }
      ],
      "by_blade": [
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/PolicyMenuBlade",
          "blade_short_name": "PolicyMenu",
          "weekly_trend": [
            {"week": "Week_1_Oldest", "wau": 38735},
            {"week": "Week_2", "wau": 42463},
            {"week": "Week_3", "wau": 44067},
            {"week": "Week_4_Recent", "wau": 42648}
          ]
        },
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/Compliance.ReactView", 
          "blade_short_name": "Compliance",
          "weekly_trend": [
            {"week": "Week_1_Oldest", "wau": 32872},
            {"week": "Week_2", "wau": 34293},
            {"week": "Week_3", "wau": 37053},
            {"week": "Week_4_Recent", "wau": 36150}
          ]
        },
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/PolicyOverviewBladeV3",
          "blade_short_name": "PolicyOverview", 
          "weekly_trend": [
            {"week": "Week_1_Oldest", "wau": 23801},
            {"week": "Week_2", "wau": 27321},
            {"week": "Week_3", "wau": 27530},
            {"week": "Week_4_Recent", "wau": 26276}
          ]
        },
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/PolicyComplianceDetail.ReactView",
          "blade_short_name": "ComplianceDetail",
          "weekly_trend": [
            {"week": "Week_1_Oldest", "wau": 10574},
            {"week": "Week_2", "wau": 11321},
            {"week": "Week_3", "wau": 11861},
            {"week": "Week_4_Recent", "wau": 11673}
          ]
        },
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/ScopeSelectorBlade",
          "blade_short_name": "ScopeSelector",
          "weekly_trend": [
            {"week": "Week_1_Oldest", "wau": 12720},
            {"week": "Week_2", "wau": 14902},
            {"week": "Week_3", "wau": 9932},
            {"week": "Week_4_Recent", "wau": 4495}
          ]
        },
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/CreateEditSelectors.ReactView", 
          "blade_short_name": "CreateEdit",
          "weekly_trend": [
            {"week": "Week_1_Oldest", "wau": 886},
            {"week": "Week_2", "wau": 2001},
            {"week": "Week_3", "wau": 1220},
            {"week": "Week_4_Recent", "wau": 923}
          ]
        }
      ]
    },
    "stickiness": {
      "calculation_method": "WAU/MAU ratio",
      "note": "Using most recent week (Week_4_Recent) WAU for stickiness calculation",
      "overall_stickiness": {
        "wau_recent": 49854,
        "mau": 150649,
        "stickiness_ratio": 0.331,
        "stickiness_percentage": "33.1%"
      },
      "by_blade": [
        {
          "blade_short_name": "PolicyMenu",
          "wau_recent": 42648,
          "mau": 128635,
          "stickiness_ratio": 0.331,
          "stickiness_percentage": "33.1%"
        },
        {
          "blade_short_name": "Compliance", 
          "wau_recent": 36150,
          "mau": 114227,
          "stickiness_ratio": 0.316,
          "stickiness_percentage": "31.6%"
        },
        {
          "blade_short_name": "PolicyOverview",
          "wau_recent": 26276,
          "mau": 78878,
          "stickiness_ratio": 0.333,
          "stickiness_percentage": "33.3%"
        },
        {
          "blade_short_name": "ComplianceDetail",
          "wau_recent": 11673,
          "mau": 33136,
          "stickiness_ratio": 0.352,
          "stickiness_percentage": "35.2%"
        },
        {
          "blade_short_name": "ScopeSelector",
          "wau_recent": 4495,
          "mau": 33972,
          "stickiness_ratio": 0.132,
          "stickiness_percentage": "13.2%"
        },
        {
          "blade_short_name": "CreateEdit",
          "wau_recent": 923,
          "mau": 4765,
          "stickiness_ratio": 0.194,
          "stickiness_percentage": "19.4%"
        }
      ]
    },
    "average_sessions_per_user": {
      "overall": {
        "total_sessions": 435586,
        "unique_users": 150648,
        "avg_sessions_per_user": 2.89
      },
      "by_blade": [
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/PolicyComplianceDetail.ReactView",
          "blade_short_name": "ComplianceDetail", 
          "total_sessions": 133592,
          "unique_users": 33133,
          "avg_sessions_per_user": 4.03
        },
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/PolicyOverviewBladeV3",
          "blade_short_name": "PolicyOverview",
          "total_sessions": 220340,
          "unique_users": 78874,
          "avg_sessions_per_user": 2.79
        },
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/PolicyMenuBlade", 
          "blade_short_name": "PolicyMenu",
          "total_sessions": 351393,
          "unique_users": 128631,
          "avg_sessions_per_user": 2.73
        },
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/ScopeSelectorBlade",
          "blade_short_name": "ScopeSelector",
          "total_sessions": 75897,
          "unique_users": 33972,
          "avg_sessions_per_user": 2.23
        },
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/Compliance.ReactView",
          "blade_short_name": "Compliance", 
          "total_sessions": 234375,
          "unique_users": 114227,
          "avg_sessions_per_user": 2.05
        },
        {
          "blade_name": "Extension/Microsoft_Azure_Policy/Blade/CreateEditSelectors.ReactView",
          "blade_short_name": "CreateEdit",
          "total_sessions": 6007,
          "unique_users": 4765,
          "avg_sessions_per_user": 1.26
        }
      ]
    },
    "sankey_diagram_data": {
      "description": "Data prepared for Sankey diagram visualization showing user flow between blades",
      "note": "Based on blade usage summary - detailed user journey analysis would require more complex queries",
      "nodes": [
        {"id": "PolicyMenu", "name": "Policy Menu", "users": 128645, "sessions": 351393},
        {"id": "Compliance", "name": "Compliance", "users": 114228, "sessions": 234375},
        {"id": "PolicyOverview", "name": "Policy Overview", "users": 78877, "sessions": 220340},
        {"id": "ComplianceDetail", "name": "Compliance Detail", "users": 33134, "sessions": 133608},
        {"id": "ScopeSelector", "name": "Scope Selector", "users": 33972, "sessions": 75889},
        {"id": "CreateEdit", "name": "Create/Edit", "users": 4765, "sessions": 6007}
      ],
      "telemetry_gap": "User journey flow between specific blades requires sequence analysis with prev()/next() functions which have limitations in current telemetry structure. Recommend adding journeyId or sequence tracking for better user flow analysis."
    }
  },
  "analysis_summary": {
    "key_findings": [
      "PolicyMenu blade has the highest MAU (128,635 users) and is the primary entry point",
      "ComplianceDetail blade has the highest engagement (4.03 avg sessions per user)",
      "Overall stickiness is 33.1% (WAU/MAU ratio)",
      "ScopeSelector shows declining weekly trend (from 14,902 to 4,495 WAU)",
      "CreateEdit blade has lowest usage (4,765 MAU) but reasonable stickiness (19.4%)"
    ],
    "data_quality_notes": [
      "All metrics use real fields from ClientTelemetry table",
      "External users only (userTypeHint == '' and requestUri startswith 'https://portal.')",
      "Microsoft internal tenant excluded (tenantId != '72f988bf-86f1-41af-91ab-2d7cd011db47')",
      "Time zone: UTC (PreciseTimeStamp field)",
      "No invented columns or assumed metrics"
    ],
    "telemetry_gaps": [
      "User journey flow analysis limited by prev()/next() function constraints",
      "No explicit journey or sequence tracking fields available",
      "Recommend adding journeyId or sessionSequence fields for better user flow analysis"
    ]
  },
  "validation_results": {
    "validation_date": "2025-09-18T18:17:48Z",
    "validation_status": "SUCCESSFUL",
    "summary": "All query validations completed successfully with discrepancies less than 5%",
    "detailed_results": {
      "mau_overall": {
        "expected": 150649,
        "actual": 150616,
        "discrepancy": -33,
        "discrepancy_percentage": -0.02,
        "status": "✅ PASS",
        "comment": "Validation successful - discrepancy is 0.02% (well below 5% threshold). Validated on 2025-09-18T18:17:48Z"
      },
      "mau_by_blade": {
        "discrepancies": [
          {
            "blade": "PolicyMenuBlade",
            "expected": 128635,
            "actual": 128637,
            "discrepancy": 2,
            "discrepancy_percentage": 0.002,
            "status": "✅ PASS"
          },
          {
            "blade": "Compliance.ReactView",
            "expected": 114227,
            "actual": 114231,
            "discrepancy": 4,
            "discrepancy_percentage": 0.004,
            "status": "✅ PASS"
          },
          {
            "blade": "PolicyOverviewBladeV3",
            "expected": 78878,
            "actual": 78881,
            "discrepancy": 3,
            "discrepancy_percentage": 0.004,
            "status": "✅ PASS"
          },
          {
            "blade": "PolicyComplianceDetail.ReactView",
            "expected": 33136,
            "actual": 33122,
            "discrepancy": -14,
            "discrepancy_percentage": -0.04,
            "status": "✅ PASS"
          },
          {
            "blade": "ScopeSelectorBlade",
            "expected": 33972,
            "actual": 33964,
            "discrepancy": -8,
            "discrepancy_percentage": -0.02,
            "status": "✅ PASS"
          },
          {
            "blade": "CreateEditSelectors.ReactView",
            "expected": 4765,
            "actual": 4763,
            "discrepancy": -2,
            "discrepancy_percentage": -0.04,
            "status": "✅ PASS"
          }
        ],
        "comment": "All blade MAU validations successful - all discrepancies are less than 0.1% (well below 5% threshold). Validated on 2025-09-18T18:17:48Z"
      },
      "wau_overall": {
        "discrepancies": [
          {
            "week": "Week_1_Oldest",
            "expected": 45333,
            "actual": 45299,
            "discrepancy": -34,
            "discrepancy_percentage": -0.07,
            "status": "✅ PASS"
          },
          {
            "week": "Week_2",
            "expected": 49461,
            "actual": 49440,
            "discrepancy": -21,
            "discrepancy_percentage": -0.04,
            "status": "✅ PASS"
          },
          {
            "week": "Week_3",
            "expected": 51344,
            "actual": 51309,
            "discrepancy": -35,
            "discrepancy_percentage": -0.07,
            "status": "✅ PASS"
          },
          {
            "week": "Week_4_Recent",
            "expected": 49854,
            "actual": 49832,
            "discrepancy": -22,
            "discrepancy_percentage": -0.04,
            "status": "✅ PASS"
          }
        ],
        "comment": "All weekly WAU validations successful - all discrepancies are less than 0.1% (well below 5% threshold). Validated on 2025-09-18T18:17:48Z"
      },
      "avg_sessions_overall": {
        "total_sessions": {
          "expected": 435586,
          "actual": 435563,
          "discrepancy": -23,
          "discrepancy_percentage": -0.005,
          "status": "✅ PASS"
        },
        "unique_users": {
          "expected": 150648,
          "actual": 150616,
          "discrepancy": -32,
          "discrepancy_percentage": -0.02,
          "status": "✅ PASS"
        },
        "avg_sessions_per_user": {
          "expected": 2.89,
          "actual": 2.89,
          "discrepancy": 0,
          "discrepancy_percentage": 0,
          "status": "✅ PASS"
        },
        "comment": "Average sessions per user validation successful - all metrics match exactly or have negligible discrepancies (well below 5% threshold). Validated on 2025-09-18T18:17:48Z"
      }
    },
    "methodology": {
      "threshold": "5% discrepancy threshold as specified",
      "calculation": "discrepancy_percentage = ((actual - expected) / expected) * 100",
      "time_sensitivity": "Small variations expected due to real-time data updates between original analysis and validation",
      "data_freshness": "Queries executed against live data, minor differences normal due to ongoing telemetry ingestion"
    }
  }
}
